from framework.dependency_management.dependency_resolver import ServiceLocator

DESCRIPTION = "Launches all Exploits for a category(ies) -i.e. for IDS testing-"
# CATEGORIES = [ 'ADMIN', 'AIX', 'BSDI', 'DIALUP', 'FREEBSD', 'HPUX', 'IRIX', 'LINUX', 'MULTI', 'NETWARE', 'OSX', 'SERVER', 'SOLARIS', 'UNIX', 'WINDOWS' ]
CATEGORIES = ['LINUX', 'WINDOWS', 'OSX']
#SUBCATEGORIES = [ 'AFP', 'ANTIVIRUS', 'ARKEIA', 'ARMLE', 'BACKDOOR', 'BACKUPEXEC', 'BRIGHTSTOR', 'BROWSER', 'DCERPC', 'DRIVER', 'DTSPCD', 'EMAIL', 'EMC', 'FILEFORMAT', 'FIREWALL', 'FTP', 'GAMES', 'HANDLER', 'HTTP', 'IDS', 'IIS', 'IMAP', 'IRC', 'ISAPI', 'LDAP', 'LICENSE', 'LOTUS', 'LPD', 'MADWIFI', 'MDNS', 'MISC', 'MMSP', 'MOTOROLA', 'MSSQL', 'MULTI', 'MYSQL', 'NFS', 'NNTP', 'NOVELL', 'NTP', 'ORACLE', 'PHP', 'POP3', 'POSTGRES', 'PPTP', 'PROXY', 'PXEXPLOIT', 'REALSERVER', 'RPC', 'RTSP', 'SAMBA', 'SCADA', 'SIP', 'SMB', 'SMTP', 'SOFTCART', 'SSH', 'SSL', 'SUNRPC', 'SVN', 'TACACS', 'TELNET', 'TFTP', 'UNICENTER', 'VNC', 'VPN', 'WEBAPP', 'WINS', 'WYSE' ]
SUBCATEGORIES = ['DCERPC', 'FTP', 'HTTP', 'IIS', 'IMAP', 'ISAPI', 'LDAP', 'LPD', 'MDNS', 'MISC', 'MMSP', 'MSSQL',
                 'MYSQL', 'NOVELL', 'NFS', 'NNTP', 'NTP', 'ORACLE', 'PHP', 'POP3', 'POSTGRES', 'PPTP', 'PROXY',
                 'REALSERVER', 'RPC', 'RTSP', 'SAMBA', 'SCADA', 'SIP', 'SMB', 'SMTP', 'SOFTCART', 'SSH', 'SSL',
                 'SUNRPC', 'SVN', 'TACACS', 'TELNET', 'TFTP', 'UNICENTER', 'VNC', 'VPN', 'WEBAPP', 'WINS', 'WYSE']


def run(PluginInfo):
    #ServiceLocator.get_component("config").Show()
    Content = DESCRIPTION + " Results:<br />"
    plugin_params = ServiceLocator.get_component("plugin_params")
    config = ServiceLocator.get_component("config")
    for Args in plugin_params.GetArgs({
                                                                          'Description': DESCRIPTION,
                                                                          'Mandatory': {
                                                                          'RHOST': config.Get('RHOST_DESCRIP'),
                                                                          'RPORT': config.Get('RPORT_DESCRIP'),
                                                                          'CATEGORY': 'Category to use (i.e. ' + ', '.join(
                                                                                  sorted(CATEGORIES)) + ')',
                                                                          'SUBCATEGORY': 'Subcategory to use (i.e. ' + ', '.join(
                                                                                  sorted(SUBCATEGORIES)) + ')'
                                                                          },
                                                                          'Optional': {
                                                                          'REPEAT_DELIM': config.Get('REPEAT_DELIM_DESCRIP')
                                                                          }}, PluginInfo):
        plugin_params.SetConfig(Args)
        #print "Args="+str(Args)
        Content += ServiceLocator.get_component("plugin_helper").DrawCommandDump('Test Command', 'Output',
                                                                                 config.GetResources(
                                                                                     'LaunchExploit_' + Args[
                                                                                         'CATEGORY'] + "_" + Args[
                                                                                         'SUBCATEGORY']), PluginInfo,
                                                                                 "")  # No previous output
    return Content

